# Jira チケット処理カスタムコマンド

## コマンド名
`/jira`

## 概要
Jira チケットの詳細を取得し、ステータスを自動更新して、指定された作業を実行するカスタムコマンドです。

## 使用方法
```
/jira <チケット番号>
```

例:
```
/jira FRT-1234
```

## 動作フロー
### 1. チケット番号の受け取り
コマンド引数として Jira のチケット番号（例: FRT-1234）を受け取ります。

### 2. チケット詳細の取得
MCPツールを使用して、指定されたチケットの以下の情報を取得します：
- タイトル
- 説明
- 開発チケットテンプレート用の説明
- 現在のステータス
- 担当者
- その他の関連情報

### 3. ステータスの自動更新
チケットのステータスが「開始」の場合：
1. ステータスを「開発中」に自動的に更新
2. 更新完了をログに記録

### 4. 作業計画の立案
チケットの説明を解析し、具体的な作業内容を特定後、その内容を報告し、承認を得ます。
承認を得られなかった場合は指示に従って計画を修正し、再度承認を求めます。以後、承認が得られるまでこれを繰り返します。

### 5. 作業の実行
承認を得られたら計画に従って作業を実行します。以下の手順に従います：
- default branch (e.g., `main`, `master` or `develop`) から新しいブランチを作成
  - ブランチ名はチケット番号を用いる (e.g., `FRT-1234`）
- コード変更の実施
- テストの実行
- ドキュメントの更新（必要な場合）
- その他指定されたタスク

### 5. 作業レポートの生成
実行した作業内容を日本語で要約し、以下の形式でレポートを作成します：

```
## 作業レポート
### チケット情報
- チケット番号: [チケット番号]
- タイトル: [チケットタイトル]
- ステータス: [更新前] → [更新後]

### 実行した作業
1. [作業内容1]
2. [作業内容2]
3. ...

### 変更したファイル
- [ファイルパス1]
- [ファイルパス2]
- ...

### 備考
[必要に応じて追加情報]
```

## エラー処理
### チケットが見つからない場合
- エラーメッセージを表示
- 正しいチケット番号の形式を案内

### MCP接続エラー
- 接続エラーの詳細を表示
- リトライオプションの提示

### ステータス更新失敗
- 失敗理由を表示
- 手動での更新方法を案内

## 実装に必要なMCPツール
### 必要なツール
1. **Jira MCP Server** - Jiraとの通信を処理
   - チケット詳細の取得
   - ステータスの更新
   - コメントの追加

## 使用例
### 基本的な使用例
```
/jira FRT-1234
```

出力例：
```
## 作業レポート

### チケット情報
- チケット番号: FRT-1234
- タイトル: ユーザー登録フォームのバリデーション追加
- ステータス: 開始 → 開発中

### 実行した作業
1. メールアドレスのバリデーション関数を追加
2. パスワード強度チェック機能を実装
3. ユニットテストを作成
4. Storybookストーリーを更新

### 変更したファイル
- src/components/user-registration/validation.ts
- src/components/user-registration/index.tsx
- src/components/user-registration/validation.test.ts
- src/components/user-registration/user-registration.stories.tsx

### 備考
- すべてのテストが成功しました
- TypeScript型チェックに問題はありません
```

## 注意事項
1. **権限の確認**
   - Jiraのチケット更新権限が必要です
   - プロジェクトへのアクセス権限を事前に確認してください
2. **ブランチの作成**
   - チケット番号を含むブランチ名を自動生成することを推奨
   - 例: `feature/FRT-1234-user-validation`
3. **コミットメッセージ**
   - チケット番号を含めることを推奨
   - 例: `FRT-1234: Add email validation to user registration form`
4. **セキュリティ**
   - APIトークンは環境変数で管理
   - コードにハードコーディングしない

## トラブルシューティング

### よくある問題

#### MCPサーバーに接続できない
```
Error: Failed to connect to MCP server
```
解決方法：
1. Claude Desktopを再起動
2. MCP設定ファイルの構文を確認
3. 環境変数が正しく設定されているか確認

#### チケットのステータス更新に失敗
```
Error: Cannot transition issue from current state
```
解決方法：
1. ワークフローの設定を確認
2. 現在のステータスから目的のステータスへの遷移が許可されているか確認
3. 必要な権限があるか確認

## 今後の拡張機能

- [ ] 複数チケットの一括処理
- [ ] PR作成との連携
- [ ] 作業時間の自動記録
- [ ] Slackへの通知連携
- [ ] カスタムワークフローのサポート
